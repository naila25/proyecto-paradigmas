<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Resultado - Trivia Universitaria</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    @keyframes confetti-fall {
      0% {
        transform: translateY(-100vh) rotate(0deg);
        opacity: 1;
      }

      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }

    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      background: #f0f;
      animation: confetti-fall 3s linear infinite;
    }

    @keyframes trophy-bounce {

      0%,
      100% {
        transform: translateY(0) rotate(0deg);
      }

      50% {
        transform: translateY(-20px) rotate(5deg);
      }
    }

    .trophy-animation {
      animation: trophy-bounce 2s ease-in-out infinite;
    }
  </style>
</head>

<body class="bg-gradient-to-r from-green-400 via-blue-500 to-purple-600 min-h-screen text-white px-4 py-8">

  <div class="container mx-auto max-w-4xl">

    {% if modo == "individual" %}
    <!-- Modo Individual -->
    <div class="text-center mb-8">
      <h1 class="text-5xl md:text-6xl font-bold mb-4 ">ğŸ‰ Â¡Juego terminado!</h1>
      <div class="bg-white/20 backdrop-blur-md rounded-xl p-8 mb-6 shadow-2xl">
        <p class="text-xl mb-2">Tu puntuaciÃ³n final:</p>
        <p class="text-6xl font-extrabold text-yellow-300 mb-4">{{ puntos }} puntos</p>

        {% if mejor_racha >= 3 %}
        <div class="bg-orange-500/30 rounded-lg p-4 mb-4">
          <p class="text-2xl">ğŸ”¥ Mejor Racha: {{ mejor_racha }} respuestas seguidas</p>
        </div>
        {% endif %}

        {% if duracion %}
        <p class="text-lg text-gray-200">â±ï¸ Tiempo de juego: {{ duracion // 60 }} min {{ duracion % 60 }} seg</p>
        {% endif %}
      </div>

      <!-- EstadÃ­sticas por categorÃ­a -->
      {% if stats %}
      <div class="bg-white/20 backdrop-blur-md rounded-xl p-6 mb-6 shadow-2xl">
        <h2 class="text-3xl font-bold mb-4">ğŸ“Š EstadÃ­sticas por CategorÃ­a</h2>

        <div class="mb-6">
          <canvas id="chartCategorias"></canvas>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
          {% for categoria, datos in stats.items() %}
          <div class="bg-white/10 rounded-lg p-3">
            <p class="text-sm font-bold capitalize mb-1">
              {% if categoria == 'historia' %}ğŸ›ï¸{% elif categoria == 'ciencia' %}ğŸ”¬{% elif categoria == 'arte' %}ğŸ¨{%
              else %}âš½{% endif %}
              {{ categoria }}
            </p>
            <p class="text-2xl font-bold">{{ datos.correctas }}/{{ datos.total }}</p>
            {% if datos.total > 0 %}
            <p class="text-xs">{{ ((datos.correctas / datos.total) * 100) | round | int }}% acierto</p>
            {% else %}
            <p class="text-xs">Sin intentos</p>
            {% endif %}
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- EvaluaciÃ³n del rendimiento -->
      <div class="bg-white/20 backdrop-blur-md rounded-xl p-6 mb-6 shadow-2xl">
        <h2 class="text-2xl font-bold mb-3">ğŸ¯ EvaluaciÃ³n</h2>
        {% if puntos >= 200 %}
        <p class="text-xl">ğŸŒŸ Â¡Excelente! Eres un maestro de la trivia</p>
        {% elif puntos >= 150 %}
        <p class="text-xl">ğŸ‘ Â¡Muy bien! Tienes grandes conocimientos</p>
        {% elif puntos >= 100 %}
        <p class="text-xl">ğŸ‘ Â¡Bien hecho! Buen desempeÃ±o</p>
        {% elif puntos >= 50 %}
        <p class="text-xl">ğŸ’ª Sigue practicando, vas por buen camino</p>
        {% else %}
        <p class="text-xl">ğŸ“š Sigue estudiando, Â¡puedes mejorar mucho!</p>
        {% endif %}
      </div>

      {% else %}
      <!-- Modo Multijugador -->
      <div class="text-center mb-8">
        <h1 class="text-5xl md:text-6xl font-bold mb-6 ">ğŸ† Resultado Final</h1>

        <!-- Anuncio del ganador -->
        <div class="bg-white/20 backdrop-blur-md rounded-xl p-8 mb-6 shadow-2xl">
          {% if ganador == 1 %}
          <p class="text-4xl font-bold mb-4 text-yellow-300">ğŸŠ Â¡{{ session.get('nombre1', 'Jugador 1')|capitalize }}
            GANA! ğŸŠ</p>
          {% elif ganador == 2 %}
          <p class="text-4xl font-bold mb-4 text-yellow-300">ğŸŠ Â¡{{ session.get('nombre2', 'Jugador 2')|capitalize }}
            GANA! ğŸŠ</p>
          {% else %}
          <p class="text-4xl font-bold mb-4 text-yellow-300">ğŸ¤ Â¡EMPATE! ğŸ¤</p>
          {% endif %}

        </div>

        <!-- ComparaciÃ³n de jugadores -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
          <!-- Jugador 1 -->
          <div
            class="bg-blue-500/30 backdrop-blur-md rounded-xl p-6 shadow-2xl {% if ganador == 1 %}ring-4 ring-yellow-400{% endif %}">
            <p class="text-2xl font-bold mb-3">ğŸ‘¤ {{ session.get('nombre1', 'Jugador 1')|capitalize }}</p>

            <div class="space-y-2">
              <p class="text-4xl font-extrabold text-yellow-300">{{ jugador1_puntos }} pts</p>
              <p class="text-lg">
                {{ 'â¤ï¸' * jugador1_vidas }}{{ 'ğŸ–¤' * (3 - jugador1_vidas) }}
              </p>
              {% if jugador1_mejor_racha >= 3 %}
              <p class="text-lg">ğŸ”¥ Mejor racha: {{ jugador1_mejor_racha }}</p>
              {% endif %}
            </div>
          </div>

          <!-- Jugador 2 -->
          <div
            class="bg-red-500/30 backdrop-blur-md rounded-xl p-6 shadow-2xl {% if ganador == 2 %}ring-4 ring-yellow-400{% endif %}">
            <p class="text-2xl font-bold mb-3">ğŸ‘¤ {{ session.get('nombre2', 'Jugador 2')|capitalize }}</p>

            <div class="space-y-2">
              <p class="text-4xl font-extrabold text-yellow-300">{{ jugador2_puntos }} pts</p>
              <p class="text-lg">
                {{ 'â¤ï¸' * jugador2_vidas }}{{ 'ğŸ–¤' * (3 - jugador2_vidas) }}
              </p>
              {% if jugador2_mejor_racha >= 3 %}
              <p class="text-lg">ğŸ”¥ Mejor racha: {{ jugador2_mejor_racha }}</p>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- GrÃ¡fico de comparaciÃ³n -->
        <div class="bg-white/20 backdrop-blur-md rounded-xl p-6 mb-6 shadow-2xl">
          <h2 class="text-2xl font-bold mb-4">ğŸ“Š ComparaciÃ³n de Puntos</h2>
          <canvas id="chartComparacion"></canvas>
        </div>

        <!-- EstadÃ­sticas por categorÃ­a -->
        {% if stats %}
        <div class="bg-white/20 backdrop-blur-md rounded-xl p-6 mb-6 shadow-2xl">
          <h2 class="text-2xl font-bold mb-4">ğŸ“ˆ EstadÃ­sticas Generales</h2>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
            {% for categoria, datos in stats.items() %}
            <div class="bg-white/10 rounded-lg p-3">
              <p class="text-sm font-bold capitalize mb-1">
                {% if categoria == 'historia' %}ğŸ›ï¸{% elif categoria == 'ciencia' %}ğŸ”¬{% elif categoria == 'arte' %}ğŸ¨{%
                else %}âš½{% endif %}
                {{ categoria }}
              </p>
              <p class="text-2xl font-bold">{{ datos.correctas }}/{{ datos.total }}</p>
              {% if datos.total > 0 %}
              <p class="text-xs">{{ ((datos.correctas / datos.total) * 100) | round | int }}%</p>
              {% endif %}
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        {% if duracion %}
        <div class="bg-white/20 backdrop-blur-md rounded-xl p-4 mb-6">
          <p class="text-lg">â±ï¸ DuraciÃ³n total: {{ duracion // 60 }} min {{ duracion % 60 }} seg</p>
        </div>
        {% endif %}
      </div>
      {% endif %}

      <!-- Botones de acciÃ³n -->
      <div class="flex flex-col md:flex-row gap-4 justify-center mb-8">
        <a href="/juego?jugadores={{ '1' if modo == 'individual' else '2' }}"
          class="bg-blue-500 hover:bg-blue-400 text-white px-8 py-4 rounded-lg text-xl font-bold shadow-lg transition transform hover:scale-105 text-center">
          ğŸ”„ Jugar de nuevo
        </a>
        <a href="/ranking"
          class="bg-yellow-500 hover:bg-yellow-400 text-black px-8 py-4 rounded-lg text-xl font-bold shadow-lg transition transform hover:scale-105 text-center">
          ğŸ† Ver Ranking
        </a>
        <a href="/"
          class="bg-purple-500 hover:bg-purple-400 text-white px-8 py-4 rounded-lg text-xl font-bold shadow-lg transition transform hover:scale-105 text-center">
          ğŸ  MenÃº Principal
        </a>
      </div>

    </div>

    <script>
      // GrÃ¡fico para modo individual
      {% if modo == "individual" and stats %}
      const ctxCategorias = document.getElementById('chartCategorias');
      if (ctxCategorias) {
        const categorias = {{ stats.keys() | list | tojson
      }};
      const correctas = [
        {% for cat, datos in stats.items() %}{ { datos.correctas } }, {% endfor %}
      ];
      const totales = [
        {% for cat, datos in stats.items() %}{ { datos.total } }, {% endfor %}
      ];

      new Chart(ctxCategorias, {
        type: 'bar',
        data: {
          labels: categorias.map(c => c.charAt(0).toUpperCase() + c.slice(1)),
          datasets: [{
            label: 'Correctas',
            data: correctas,
            backgroundColor: 'rgba(34, 197, 94, 0.7)',
            borderColor: 'rgba(34, 197, 94, 1)',
            borderWidth: 2
          }, {
            label: 'Incorrectas',
            data: totales.map((t, i) => t - correctas[i]),
            backgroundColor: 'rgba(239, 68, 68, 0.7)',
            borderColor: 'rgba(239, 68, 68, 1)',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          scales: {
            y: {
              beginAtZero: true,
              ticks: { color: '#fff', stepSize: 1 },
              grid: { color: 'rgba(255,255,255,0.1)' }
            },
            x: {
              ticks: { color: '#fff' },
              grid: { color: 'rgba(255,255,255,0.1)' }
            }
          },
          plugins: {
            legend: {
              labels: { color: '#fff', font: { size: 14 } }
            }
          }
        }
      });
    }
      {% endif %}

      // GrÃ¡fico para modo multijugador
      {% if modo == "multijugador" %}
      const ctxComp = document.getElementById('chartComparacion');
      if (ctxComp) {
        new Chart(ctxComp, {
          type: 'bar',
          data: {
            labels: [
              '{{ session.get("nombre1", "Jugador 1")|capitalize }}',
              '{{ session.get("nombre2", "Jugador 2")|capitalize }}'
            ],
            datasets: [{
              label: 'Puntos',
              data: [{{ jugador1_puntos }}, {{ jugador2_puntos }}],
          backgroundColor: [
            'rgba(59, 130, 246, 0.7)',
            'rgba(239, 68, 68, 0.7)'
          ],
          borderColor: [
            'rgba(59, 130, 246, 1)',
            'rgba(239, 68, 68, 1)'
          ],
          borderWidth: 2
        }]
        },
      options: {
        responsive: true,
          maintainAspectRatio: true,
            scales: {
          y: {
            beginAtZero: true,
              ticks: { color: '#fff' },
            grid: { color: 'rgba(255,255,255,0.1)' }
          },
          x: {
            ticks: { color: '#fff', font: { size: 16, weight: 'bold' } },
            grid: { color: 'rgba(255,255,255,0.1)' }
          }
        },
        plugins: {
          legend: {
            display: false
          }
        }
      }
      });
    }
      {% endif %}

      // AnimaciÃ³n de confeti para el ganador
      {% if modo == "multijugador" and ganador in [1, 2] %}
      function createConfetti() {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + '%';
        confetti.style.animationDelay = Math.random() * 3 + 's';
        confetti.style.backgroundColor = ['#ff0', '#f0f', '#0ff', '#f00', '#0f0'][Math.floor(Math.random() * 5)];
        document.body.appendChild(confetti);
        setTimeout(() => confetti.remove(), 3000);
      }
      for (let i = 0; i < 50; i++) {
        setTimeout(createConfetti, i * 100);
      }
      {% endif %}
    </script>
</body>

</html>